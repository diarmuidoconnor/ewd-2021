# JSON Web Tokens


# Set up
You will need the solution form last weeks lab(lab-node3) as a starting point. If you do not have a solution, you can use a partial solution to the last lab(lab-api3) in the code archives for this topic on the website.

**THE FOLLOWING STEPS ARE FOR THE EXPRESS MOVIEDB API**

## Install dependencies
You'll need the following dependencies to implement the authentication functionality:

~~~bash
    npm install --save passport passport-jwt jsonwebtoken bcryptjs
~~~


## Create Encryption Middleware
You will need to create a new user model for authentication.

- create the folder, ***/src/accounts/security/bcrypt***. Create a script index.js with the following content:

~~~javascript
import EncryptionService from '../AuthenticationService';
import bcrypt from 'bcryptjs';

export default class extends EncryptionService {

    async encrypt(password) {
        const salt = await bcrypt.genSalt(10);
        return bcrypt.hash(password, salt);
    }

    async compare(password, encryptedPassword) {
        try {
            // Compare password
            const result = await bcrypt.compare(password, encryptedPassword);
            return result;
        } catch (error) {
            return false;
        }


    }
}
~~~

+ Update dependencies /src/config

~~~javascript
//... other code
import Authenticator from './../accounts/security/bcrypt';
//... other code
~~~

+ update the registerAccount and updateAccount service functions to include the Authenticator dependency and apply encryption to the password.

  <img src="./img/image-20220401103918378.png" alt="image-20220401103918378" style="zoom:67%;" />

  ## Test it...

+ Test that the encryption is working by registering an account:
  <img src="./img/image-20220401104528943.png" alt="image-20220401104528943" style="zoom: 50%;" />

+ Also, you can check in the MongoDB using Compass.

+ Check that the Authentication endpoint (POST /api/accounts/security/token) still works:
  <img src="./img/image-20220401104751431.png" alt="image-20220401104751431" style="zoom:50%;" />



Note how the passwords are being hashed before being saved in the database.