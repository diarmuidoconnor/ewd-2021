# React - Movies Data

At the moment the Movies page returns just a heading. In this step you'll include a Movies Context (similar to assignment 1, but simpler) and update the Movies page to use it to display a list of Movies. 

## Update movie-api.js script

+ Open the file */src/api/movie-api.js* and add the following function at the end of the file:

~~~javascript
export const getMovies = async () => {
    const res = await fetch(
        '/api/movies', {
            headers: {
                'Authorization': window.localStorage.getItem('token')
            }
    }
    )
    return res.json();
};
~~~

in the above code, notice how the JWT token is retrieved from local storage and included in the header of the request to */api/movies*.

## Add a Movies context

+ In */src/sample/* create a new file called *moviesContext.js*  with  the following contents:

~~~javascript
import React, { useState, createContext, useEffect, useReducer } from "react";
import { getMovies } from "./api/movie-api";

export const MoviesContext = createContext(null);


const MoviesContextProvider = props => {
  const [movies,setMovies] = useState(null);
  const [authenticated, setAuthenticated] = useState(false);

  useEffect(() => {
 if(authenticated){
    getMovies().then(result => {
      console.log(result);
      setMovies(result);
    });}
  },[authenticated]);

  return (
    <MoviesContext.Provider
      value={{
        movies,
        setAuthenticated
      }}
    >
      {props.children}
    </MoviesContext.Provider>
  );
};

export default MoviesContextProvider
~~~

## Add the Movie Context wrapping to App

Open */src/sample/index.js* and add the **MovieContext** as follows:
  + Import the MovieProvider from moviesContext
  + Wrap the ``<Switch>`` element with the ``<MovieProvider>``. (**Dont add a second ``<Switch>`` element!**)

See the following code snippet as a guide 

~~~javascript
...

import MovieProvider from "./moviesContext";

...
    <MovieProvider>
      <Switch>
                ...
                
                ...
      </Switch>
    </MovieProvider>
 ....
~~~

## Update the Movies Page

+ Open the file */src/sample/pages.js* and add the following import statements at the top of the file:  
~~~javascript
import { useContext} from 'react';
import { MoviesContext } from './moviesContext';
~~~

+ In the same file locate the ``Movies`` function that returns the movies page. Replace the ``Movies`` function with the following:  
~~~javascript
 export const Movies = () => {
    const context = useContext(MoviesContext);
    return <>
        <h2>Movies Data </h2>
        <div>
            {context.movies?context.movies.results.map(movie => { return <>{movie.id},{movie.title}<br /></> }):<br />}
        </div>
    </>
}
~~~

## Test The App

+ Finally, Open the React App in the browser, authenticate and access the Movies page. You should see the following, raw list fo movies:  
![Movies List](./img/6.png)  

Once authenticated, the movies context uses the ``getMovies()`` function to get the movie list. The app accesses the JWT token in the local storage of the browser and includes this HTTP requests to the API. 

## Commit it!
Commit your changes
~~~bash
git add -A
git commit -m "Topic 11 - I've completed all my labs!"
git push
~~~